y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_phylum_allsamples.svg")
print(barplot_tax_phylum)
dev.off()
# Class level
class <- aggregate_rare(physeq,
level = "Class",
detection = 0.01,
prevalence = 50/100)
barplot_tax_class <- plot_bar(class,
fill = "Class") +
facet_grid(.~metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Class") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_class_allsamples.svg")
print(barplot_tax_class)
dev.off()
# Order level
order <- aggregate_rare(physeq,
level = "Order",
detection = 0.01,
prevalence = 50/100)
barplot_tax_order <- plot_bar(order,
fill = "Order") +
facet_grid(.~metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Order") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_order_allsamples.svg")
print(barplot_tax_order)
dev.off()
# Family level
family <- aggregate_rare(physeq,
level = "Family",
detection = 0.01,
prevalence = 50/100)
barplot_tax_family <- plot_bar(family,
fill = "Family") +
facet_grid(.~metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Family") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_family_allsamples.svg")
print(barplot_tax_family)
dev.off()
# Genera level
genera <- aggregate_rare(physeq,
level = "Genus",
detection = 0,
prevalence = 0)
genera.df <- phyloseq_to_df(genera,
addtax = FALSE,
addtot = FALSE,
addmaxrank = FALSE,
sorting = "NULL")
write.table(genera.df,
"./00_files/genera_taxonomic_profile_allsamples.tsv",
sep = "\t")
genera <- aggregate_rare(physeq,
level = "Genus",
detection = 0.01,
prevalence = 50/100)
barplot_tax_genera <- plot_bar(genera,
fill = "Genus") +
facet_grid(.~metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Genus") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_genera_allsamples.svg")
print(barplot_tax_genera)
dev.off()
# Species level
species <- aggregate_rare(physeq,
level = "Species",
detection = 0,
prevalence = 0)
##### Prevotella copri boxplot
#
# p_value <- p_value <- list(c("Control",
#                              "NASH"))
#
# boxplot_prevotella_copri <- boxplot_abundance(species,
#                                               x="metformin_nash_presence",
#                                               y="Prevotella_copri",
#                                               show.points = FALSE) +
#   geom_boxplot(aes(color = metformin_nash_presence),
#              outlier.shape = NA) +
#   geom_point(aes(color = metformin_nash_presence),
#     size = 2,
#     shape = 21,
#     position = position_jitterdodge()) +
#   labs(x = "",
#     y = "Prevotella copri (Abundancia relativa)") +
#   stat_compare_means(comparisons = p_value,
#                      method = "wilcox.test") +
#   theme(legend.position = "none")
#
# ggsave("./01_tax_plots/boxplot_prevotella_copri_allsamples.svg")
# print(boxplot_prevotella_copri)
# dev.off()
#####
species.df <- phyloseq_to_df(species,
addtax = FALSE,
addtot = FALSE,
addmaxrank = FALSE,
sorting = "NULL")
write.table(species.df,
"./00_files/species_taxonomic_profile_allsamples.tsv",
sep = "\t")
species <- aggregate_rare(physeq,
level = "Species",
detection = 0.01,
prevalence = 50/100)
barplot_tax_species <- plot_bar(species,
fill = "Species") +
facet_grid(.~metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Species") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_species_allsamples.svg")
print(barplot_tax_species)
dev.off()
# Input table
biom_otu_tax <- import_biom(biom_file)
metadata <- import_qiime_sample_data(map_file)
physeq <- merge_phyloseq(biom_otu_tax,
metadata)
physeq_lefse <- normalize(physeq,
method = "CPM")
colnames(tax_table(physeq_lefse)) <- c("Kingdom",
"Phylum",
"Class",
"Order",
"Family",
"Genus",
"Species")
theme_set(theme_bw())
# LEfSe Phylum
#lefse_phylum <- run_lefse(physeq_lefse,
#                          norm = "none",
#                          taxa_rank = "Phylum",
#                          group = "metformin_nash_presence")
#
#plot_lefse_phylum <- plot_ef_bar(lefse_phylum)
#
#ggsave("./01_tax_plots/metaphlan3_phylum_lefse.svg")
#print(plot_lefse_phylum)
#dev.off()
# LEfSe Class
#lefse_class <- run_lefse(physeq_lefse,
#                          norm = "none",
#                          taxa_rank = "Class",
#                          group = "metformin_nash_presence")
#plot_lefse_class <- plot_ef_bar(lefse_class)
#ggsave("./01_tax_plots/metaphlan3_class_lefse.svg")
#print(plot_lefse_class)
#dev.off()
# LEfSe Order
# lefse_order <- run_lefse(physeq_lefse,
#                           norm = "none",
#                           taxa_rank = "Order",
#                           group = "metformin_nash_presence")
#
# plot_lefse_order <- plot_ef_bar(lefse_order)
#
# ggsave("./01_tax_plots/metaphlan3_order_lefse.svg")
# print(plot_lefse_order)
# dev.off()
# LEfSe Family
# lefse_family <- run_lefse(physeq_lefse,
#                           norm = "none",
#                           taxa_rank = "Family",
#                           group = "metformin_nash_presence")
#
# plot_lefse_family <- plot_ef_bar(lefse_family)
#
# ggsave("./01_tax_plots/metaphlan3_family_lefse.svg")
# print(plot_lefse_family)
# dev.off()
# LEfSe Genera
# lefse_genera <- run_lefse(physeq_lefse,
#                           norm = "none",
#                           taxa_rank = "Genus",
#                           group = "metformin_nash_presence")
#
# plot_lefse_genera <- plot_ef_bar(lefse_genera)
#
# ggsave("./01_tax_plots/metaphlan3_genera_lefse.svg")
# print(plot_lefse_genera)
# dev.off()
# LEfSe Species
lefse_species <- run_lefse(physeq_lefse,
norm = "none",
taxa_rank = "Species",
group = "metformin_nash_presence")
# Input table
biom_otu_tax <- import_biom(biom_file)
metadata <- import_qiime_sample_data(map_file)
physeq <- merge_phyloseq(biom_otu_tax,
metadata)
physeq_lefse <- normalize(physeq,
method = "CPM")
colnames(tax_table(physeq_lefse)) <- c("Kingdom",
"Phylum",
"Class",
"Order",
"Family",
"Genus",
"Species")
theme_set(theme_bw())
# LEfSe Phylum
#lefse_phylum <- run_lefse(physeq_lefse,
#                          norm = "none",
#                          taxa_rank = "Phylum",
#                          group = "metformin_nash_presence")
#
#plot_lefse_phylum <- plot_ef_bar(lefse_phylum)
#
#ggsave("./01_tax_plots/metaphlan3_phylum_lefse.svg")
#print(plot_lefse_phylum)
#dev.off()
# LEfSe Class
#lefse_class <- run_lefse(physeq_lefse,
#                          norm = "none",
#                          taxa_rank = "Class",
#                          group = "metformin_nash_presence")
#plot_lefse_class <- plot_ef_bar(lefse_class)
#ggsave("./01_tax_plots/metaphlan3_class_lefse.svg")
#print(plot_lefse_class)
#dev.off()
# LEfSe Order
# lefse_order <- run_lefse(physeq_lefse,
#                           norm = "none",
#                           taxa_rank = "Order",
#                           group = "metformin_nash_presence")
#
# plot_lefse_order <- plot_ef_bar(lefse_order)
#
# ggsave("./01_tax_plots/metaphlan3_order_lefse.svg")
# print(plot_lefse_order)
# dev.off()
# LEfSe Family
# lefse_family <- run_lefse(physeq_lefse,
#                           norm = "none",
#                           taxa_rank = "Family",
#                           group = "metformin_nash_presence")
#
# plot_lefse_family <- plot_ef_bar(lefse_family)
#
# ggsave("./01_tax_plots/metaphlan3_family_lefse.svg")
# print(plot_lefse_family)
# dev.off()
# LEfSe Genera
# lefse_genera <- run_lefse(physeq_lefse,
#                           norm = "none",
#                           taxa_rank = "Genus",
#                           group = "metformin_nash_presence")
#
# plot_lefse_genera <- plot_ef_bar(lefse_genera)
#
# ggsave("./01_tax_plots/metaphlan3_genera_lefse.svg")
# print(plot_lefse_genera)
# dev.off()
# LEfSe Species
lefse_species <- run_lefse(physeq_lefse,
norm = "none",
taxa_rank = "Species",
group = "metformin_nash_presence")
\
knitr::opts_chunk$set(echo = TRUE)
# Libraries required
library("colorRamps")
library("ggplot2")
library("reshape")
library("scales")
library("jcolors")
library("grid")
library("RColorBrewer")
library("dplyr")
library("ggpubr")
library("phyloseq")
library("microbiome")
library("vegan")
library("metagMisc")
library("DiagrammeR")
library("microbiomeMarker")
# Input table
biom_file <- "./00_files/metaphlan3_taxonomic_profile_filt.biom"
map_file <- "./00_files/metadata_no-metformin_nash_presence.tsv"
knitr::opts_chunk$set(echo = TRUE)
# Libraries required
library("colorRamps")
library("ggplot2")
library("reshape")
library("scales")
library("jcolors")
library("grid")
library("RColorBrewer")
library("dplyr")
library("ggpubr")
library("phyloseq")
library("microbiome")
library("vegan")
library("metagMisc")
library("DiagrammeR")
library("microbiomeMarker")
metadata <- read.delim("./00_files/metadata_no-metformin_nash_presence.tsv")
knitr::kable(
metadata
)
# Input table
biom_file <- "./00_files/metaphlan3_taxonomic_profile_filt.biom"
map_file <- "./00_files/metadata_no-metformin_nash_presence.tsv"
biom_otu_tax <- import_biom(biom_file)
metadata <- import_qiime_sample_data(map_file)
physeq <- merge_phyloseq(biom_otu_tax,
metadata)
physeq <- normalize(physeq,
method = "TSS")
colnames(tax_table(physeq)) <- c("Kingdom",
"Phylum",
"Class",
"Order",
"Family",
"Genus",
"Species")
theme_set(theme_bw())
# Phylum level
phylum <- aggregate_rare(physeq,
level = "Phylum",
detection = 0.0001,
prevalence = 50/100)
barplot_tax_phylum <- plot_bar(phylum,
fill = "Phylum") +
facet_grid(.~no-metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_phylum_allsamples.svg")
# Input table
biom_file <- "./00_files/metaphlan3_taxonomic_profile_filt.biom"
map_file <- "./00_files/metadata_no-metformin_nash_presence.tsv"
biom_otu_tax <- import_biom(biom_file)
metadata <- import_qiime_sample_data(map_file)
physeq <- merge_phyloseq(biom_otu_tax,
metadata)
physeq <- normalize(physeq,
method = "TSS")
colnames(tax_table(physeq)) <- c("Kingdom",
"Phylum",
"Class",
"Order",
"Family",
"Genus",
"Species")
theme_set(theme_bw())
# Phylum level
phylum <- aggregate_rare(physeq,
level = "Phylum",
detection = 0.0001,
prevalence = 50/100)
barplot_tax_phylum <- plot_bar(phylum,
fill = "Phylum") +
facet_grid(.~no-metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_phylum_allsamples.svg")
# Input table
biom_file <- "./00_files/metaphlan3_taxonomic_profile_filt.biom"
map_file <- "./00_files/metadata_no-metformin_nash_presence.tsv"
biom_otu_tax <- import_biom(biom_file)
metadata <- import_qiime_sample_data(map_file)
physeq <- merge_phyloseq(biom_otu_tax,
metadata)
physeq <- normalize(physeq,
method = "TSS")
colnames(tax_table(physeq)) <- c("Kingdom",
"Phylum",
"Class",
"Order",
"Family",
"Genus",
"Species")
theme_set(theme_bw())
# Phylum level
phylum <- aggregate_rare(physeq,
level = "Phylum",
detection = 0.0001,
prevalence = 50/100)
barplot_tax_phylum <- plot_bar(phylum,
fill = "Phylum") +
facet_grid(.~no-metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
barplot_tax_phylum
barplot_tax_phylum <- plot_bar(phylum,
fill = "Phylum") +
facet_grid(.~no_metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_phylum_allsamples.svg")
barplot_tax_phylum <- plot_bar(phylum,
fill = "Phylum") +
facet_grid(.~no-metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_phylum_allsamples.svg")
# Phylum level
phylum <- aggregate_rare(physeq,
level = "Phylum",
detection = 0.0001,
prevalence = 50/100)
barplot_tax_phylum <- plot_bar(phylum,
fill = "Phylum") +
facet_grid(.~no-metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_phylum_allsamples.svg")
print(barplot_tax_phylum)
barplot_tax_phylum
barplot_tax_phylum <- plot_bar(phylum,
fill = "Phylum") +
facet_grid(.~no/-metformin_nash_presence,
scales = "free_x") +
labs(x = "",
y = "Relative abundance",
fill = "Phylum") +
scale_x_discrete(expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme(axis.text.x = element_text(size = 7,
angle = 90,
vjust = 0.5))
ggsave("./01_tax_plots/metaphlan3_phylum_allsamples.svg")
print(barplot_tax_phylum)
